# ============================================================================
# Perseus Data Migration - SQL Server Connection Configuration
# ============================================================================
# Purpose: Credentials for extract-data.sh script
# Security: DO NOT commit .env file to git (already in .gitignore)
# Usage: Copy this file to .env and fill in your credentials
# ============================================================================

# SQL Server Connection Details
SQL_SERVER=sqlserver-host-instance                          # SQL Server hostname or IP
SQL_USER=sa                       # SQL Server username
SQL_PASSWORD=your_password_here             # SQL Server password (SENSITIVE)
SQL_DATABASE=db_name                        # Database name

# Query Execution Settings
SQL_TIMEOUT=1800                            # Query timeout in seconds (default: 30 min)
                                            # NOTE: Maps to TIMEOUT variable in script
                                            # Override via CLI: ./extract-data.sh --timeout 3600

# Data Export Settings
DATA_DIR=/tmp/perseus-data-export           # CSV export directory (must have 3GB+ free)
LOG_DIR=./logs                              # Log file directory

# BCP Export Settings
BCP_BATCH_SIZE=10000                        # Rows per batch (default: 10,000)
BCP_ERROR_FILE=${DATA_DIR}/bcp-errors.log   # BCP error log location

# ============================================================================
# SETUP INSTRUCTIONS
# ============================================================================
# 1. Copy this file:
#    cp .env.example .env
#
# 2. Edit .env with your credentials:
#    vim .env  # or nano, code, etc.
#
# 3. Secure the file (chmod 600 recommended):
#    chmod 600 .env
#
# 4. Verify connection:
#    ./extract-data.sh --dry-run
#
# ============================================================================

# ============================================================================
# SECURITY NOTES
# ============================================================================
# - .env file contains SENSITIVE credentials - never commit to git
# - Use read-only account (sqlapps-repl) for production extractions
# - Consider using Azure Key Vault or secrets manager for CI/CD pipelines
# - Rotate passwords regularly per security policy
# - Limit network access (firewall rules) to SQL Server from extraction host
# ============================================================================

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Connection Test:
#   sqlcmd -S $SQL_SERVER -U $SQL_USER -P "$SQL_PASSWORD" -d $SQL_DATABASE -Q "SELECT @@VERSION"
#
# Verify Permissions:
#   sqlcmd -S $SQL_SERVER -U $SQL_USER -P "$SQL_PASSWORD" -d $SQL_DATABASE \
#     -Q "SELECT HAS_DBACCESS('perseus') AS has_access"
#
# Check Tempdb Space:
#   sqlcmd -S $SQL_SERVER -U $SQL_USER -P "$SQL_PASSWORD" -d tempdb \
#     -Q "SELECT SUM(unallocated_extent_page_count)*8/1024 AS free_mb FROM sys.dm_db_file_space_usage"
# ============================================================================
