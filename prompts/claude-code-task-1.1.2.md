# Task 1.1.2 - Extension & Dependency Check
## Claude Code Execution Prompt

**Sprint:** 9 | **Day:** 1 | **Priority:** P0 CRITICAL | **Time:** 1.0h

---

## ğŸ¯ MISSION

Create validation script: `scripts/validation/staging-dependency-check.sh`

**Check:**
1. PostgreSQL extensions (postgres_fdw, plpgsql, pg_stat_statements)
2. Functions (McGetUpStreamByList, GetTreeList, GetBothParents)
3. Views (from procedure dependencies)
4. External connections (Argus via postgres_fdw)

**Generate:** `docs/reports/dependencies-staging-status.md`

---

## ğŸ“ REQUIREMENTS

### Extensions (CRITICAL)
```
âœ… postgres_fdw - Argus connection (P0 BLOCKER if missing)
âœ… plpgsql - Standard language
âœ… pg_stat_statements - Monitoring
```

### Functions (HIGH)
```
âœ… McGetUpStreamByList(varchar[]) - Multi-procedure dependency
âœ… GetTreeList(...) - Tree operations
âœ… GetBothParents(...) - Relationship traversal
```
Verify: exists in `perseus_dbo`, correct signature

### External (CRITICAL)
```
âœ… Argus foreign server configured
âœ… Connection test successful
âœ… Query test on container_types
```

---

## ğŸ› ï¸ SCRIPT FEATURES

**Must Have:**
- POSIX bash, error handling (`set -euo pipefail`)
- Env vars: `DB_HOST`, `DB_USER`, `DB_PASS`
- Options: `--help`, `--verbose`, `--dry-run`
- Exit codes: 0=success, 1=issues, 2=error
- Markdown report generation

**Usage:**
```bash
./scripts/validation/staging-dependency-check.sh
./scripts/validation/staging-dependency-check.sh --verbose
./scripts/validation/staging-dependency-check.sh --database staging
```

---

## ğŸ“Š REPORT FORMAT

```markdown
# STAGING Dependencies Report

**Date:** 2025-12-09
**Status:** âœ… READY | âš ï¸ ISSUES | âŒ CRITICAL

## Executive Summary
[Overview]

## Extensions
| Name | Status | Version | Notes |
|------|--------|---------|-------|
| postgres_fdw | âœ… PRESENT | 17.0 | Ready |

## Functions  
| Name | Status | Schema | Signature |
|------|--------|--------|------|
| McGetUpStreamByList | âœ… | perseus_dbo | (varchar[]) |

## External Connections
### Argus (postgres_fdw)
- Server: âœ… PRESENT / âŒ MISSING
- Connection: âœ… SUCCESS / âŒ FAILED
- Query test: [result]

## Issues (P0/P1/P2)
[List with priority]

## Recommendations
1. [Action 1]

---
**Generated by:** Claude Code
```

---

## âš ï¸ CRITICAL

- **Argus connection** = P0 BLOCKER (usp_UpdateContainerTypeFromArgus depends on it)
- **Function signatures** must match exactly (wrong = runtime fail)
- **NO hardcoded credentials** (use env vars)
- **Complete even if checks fail** (aggregate all issues)

---

## â±ï¸ TIME BUDGET (1.0h)

- 10 min: Read context
- 30 min: Generate script
- 10 min: Add error handling
- 5 min: Test syntax
- 5 min: Update tracker

---

## ğŸ”— CONTEXT

- Instructions: `docs/CLAUDE-CODE-INSTRUCTIONS.md`
- Sprint Plan: `docs/sprint9-execution-plan.md`
- Tracker: `tracking/progress-tracker.md`

---

## âœ… SUCCESS

- [ ] Script created & executable
- [ ] All checks implemented
- [ ] Report template generated
- [ ] Exit codes correct
- [ ] Documentation complete
- [ ] Tracker updated
- [ ] Handoff prepared

---

## ğŸ“ REPORT BACK

```
âœ… TASK 1.1.2 COMPLETE

FILES:
âœ… scripts/validation/staging-dependency-check.sh (XXX lines)
âœ… docs/reports/dependencies-staging-status.md (YYY lines)

FEATURES:
âœ… Extension/function/view/connection checks
âœ… Error handling
âœ… Report generation
âœ… Help documentation

VALIDATION:
âœ… Syntax: PASSED
âœ… Executable: YES

TIME: Xh / 1.0h

NEXT: Desktop Task 1.1.3 (Analyze Report)

Roger. Over. ğŸ“¡
```

---

**Ready to execute!** ğŸš€