{
  "permissions": {
    "allow": [
      "Bash(source:*)",
      "Bash(sqlcmd:*)",
      "Bash(cd:*)",
      "Bash(grep:*)",
      "Bash(wc:*)",
      "Bash(done)",
      "Bash(__NEW_LINE_4a18dcb27785df05__ echo \"=== FINAL VERIFICATION ===\")",
      "Bash(while read var)",
      "Bash(do)",
      "Bash(bash:*)",
      "mcp__plugin_serena_serena__read_file",
      "Bash(export SQL_SERVER=wrong_server)",
      "Bash(./extract-data.sh:*)",
      "Bash(SQL_SERVER=wrong_server DATA_DIR=/wrong/path ./extract-data.sh:*)",
      "Bash(gh issue list:*)",
      "Bash(git -C /Users/pierre.ribeiro/.claude-worktrees/US3-table-structures log --oneline -15)",
      "Bash(gh repo list:*)",
      "Bash(gh issue view:*)",
      "Bash(xargs:*)",
      "Bash(gh issue comment:*)",
      "Bash(gh issue close:*)",
      "Bash(cat:*)",
      "Bash(find:*)",
      "Bash(python3:*)",
      "mcp__plugin_claude-mem_mcp-search__search",
      "Bash(for f in \"./14. create-table/\"*.sql)",
      "Bash(do basename \"$f\" .sql)",
      "Bash(\"/Users/pierre.ribeiro/.claude-worktrees/US3-table-structures/docs/db-design/pgsql/perseus-data-dictionary.md\" << 'EOF'\n\n### ⭐ goo_type \\(P0 CRITICAL\\)\n\n**Purpose**: Material type hierarchy using nested set model for efficient ancestor/descendant queries.\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~100-500 types\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Material type name \\(UNIQUE\\) |\n| color | VARCHAR\\(50\\) | NULL | - | UI display color |\n| left_id | INTEGER | NOT NULL | - | Nested set left boundary |\n| right_id | INTEGER | NOT NULL | - | Nested set right boundary |\n| scope_id | VARCHAR\\(50\\) | NOT NULL | - | Nested set scope identifier |\n| disabled | INTEGER | NOT NULL | 0 | Soft delete flag \\(0=active, 1=disabled\\) |\n| casrn | VARCHAR\\(150\\) | NULL | - | CAS Registry Number |\n| iupac | VARCHAR\\(150\\) | NULL | - | IUPAC chemical name |\n| depth | INTEGER | NOT NULL | 0 | Hierarchy depth \\(0=root\\) |\n| abbreviation | VARCHAR\\(20\\) | NULL | - | Short code \\(UNIQUE\\) |\n| density_kg_l | DOUBLE PRECISION | NULL | - | Material density \\(kg/L\\) |\n\n#### Constraints\n\n- **Primary Key**: `pk_goo_type` on `\\(id\\)`\n- **Unique**: `uq_goo_type_name` on `\\(name\\)`\n- **Unique**: `uq_goo_type_abbreviation` on `\\(abbreviation\\)`\n- **Check**: `chk_goo_type_hierarchy` - `hierarchy_left < hierarchy_right`\n\n#### Indexes\n\nNone \\(queries use nested set left/right ranges\\)\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**: \n  - coa \\(goo_type_id\\)\n  - external_goo_type \\(goo_type_id\\)\n  - goo_type_combine_target \\(goo_type_id\\)\n  - smurf_goo_type \\(goo_type_id\\)\n  - goo_type_combine_component \\(goo_type_id\\)\n  - material_inventory_threshold \\(material_type_id\\)\n  - recipe \\(goo_type_id\\)\n  - recipe_part \\(goo_type_id\\)\n  - workflow_step \\(goo_type_id\\)\n  - goo \\(goo_type_id\\)\n\n#### Special Notes\n\n1. **Nested Set Model**: Enables efficient hierarchy queries without recursion\n   - Ancestors: `WHERE left_id < X AND right_id > X`\n   - Descendants: `WHERE left_id > X AND right_id < X`\n   - Depth: Calculated from hierarchy depth\n2. **P0 Critical**: Required for ALL material operations\n3. **Check Constraint**: Enforces valid nested set structure\n\n---\n\n### ⭐ m_upstream \\(P0 CRITICAL\\)\n\n**Purpose**: Cached upstream material lineage graph for high-performance queries.\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~10,000-100,000 paths\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| start_point | VARCHAR\\(50\\) | NOT NULL | - | Starting material UID |\n| end_point | VARCHAR\\(50\\) | NOT NULL | - | Upstream ancestor UID |\n| path | VARCHAR\\(500\\) | NOT NULL | - | Full path \\(comma-separated UIDs\\) |\n| level | INTEGER | NOT NULL | - | Path depth \\(1=direct parent\\) |\n\n#### Constraints\n\n- **Primary Key**: `pk_m_upstream` on `\\(id\\)` \\(composite on start_point, end_point, level likely\\)\n- **No Foreign Keys**: Denormalized cache table\n\n#### Indexes\n\nNone documented \\(may need composite index on start_point, level\\)\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**: None \\(read-only cache\\)\n\n#### Special Notes\n\n1. **Denormalized Cache**: Populated by stored procedures \\(`mcgetupstream`, `reconcile_mupstream`\\)\n2. **P0 Critical**: Essential for upstream material tracking queries\n3. **Update Strategy**: Incremental updates via triggers on material_transition\n4. **Performance**: Pre-computed paths avoid recursive CTE overhead\n\n---\n\n### ⭐ m_downstream \\(P0 CRITICAL\\)\n\n**Purpose**: Cached downstream material lineage graph for high-performance queries.\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~10,000-100,000 paths\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| start_point | VARCHAR\\(50\\) | NOT NULL | - | Starting material UID |\n| end_point | VARCHAR\\(50\\) | NOT NULL | - | Downstream descendant UID |\n| path | VARCHAR\\(500\\) | NOT NULL | - | Full path \\(comma-separated UIDs\\) |\n| level | INTEGER | NOT NULL | - | Path depth \\(1=direct child\\) |\n\n#### Constraints\n\n- **Primary Key**: `pk_m_downstream` on `\\(id\\)` \\(composite on start_point, end_point, level likely\\)\n- **No Foreign Keys**: Denormalized cache table\n\n#### Indexes\n\nNone documented \\(may need composite index on start_point, level\\)\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**: None \\(read-only cache\\)\n\n#### Special Notes\n\n1. **Denormalized Cache**: Populated by stored procedures \\(`mcgetdownstream`\\)\n2. **P0 Critical**: Essential for downstream material tracking queries\n3. **Update Strategy**: Incremental updates via triggers on transition_material\n4. **Performance**: Pre-computed paths avoid recursive CTE overhead\n\n---\n\n### manufacturer\n\n**Purpose**: Vendor/supplier organizations for materials and equipment.\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~50-200\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Manufacturer name \\(UNIQUE\\) |\n| abbreviation | VARCHAR\\(20\\) | NULL | - | Short code |\n| disabled | INTEGER | NOT NULL | 0 | Soft delete flag |\n\n#### Constraints\n\n- **Primary Key**: `pk_manufacturer` on `\\(id\\)`\n- **Unique**: `uq_manufacturer_name` on `\\(name\\)`\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**:\n  - external_goo_type \\(manufacturer_id\\)\n  - perseus_user \\(manufacturer_id\\) - **3 duplicate FKs consolidated to 1**\n  - workflow \\(manufacturer_id\\)\n  - fatsmurf \\(organization_id references this table\\)\n  - goo \\(manufacturer_id\\)\n\n#### Special Notes\n\n1. **Duplicate FK Issue**: perseus_user originally had 3 FK constraints to this table \\(migration artifact\\) - consolidated to 1\n2. **Soft Delete**: disabled=1 hides from UI without breaking referential integrity\n\n---\n\n### unit\n\n**Purpose**: Units of measurement \\(mass, volume, concentration, etc.\\)\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~20-50\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Unit name \\(UNIQUE\\) |\n| abbreviation | VARCHAR\\(20\\) | NULL | - | Short symbol \\(e.g., \"mg\", \"mL\"\\) |\n| dimensions | VARCHAR\\(150\\) | NULL | - | Physical dimensions |\n| disabled | INTEGER | NOT NULL | 0 | Soft delete flag |\n| unit_type_id | INTEGER | NULL | - | Unit category |\n\n#### Constraints\n\n- **Primary Key**: `pk_unit` on `\\(id\\)`\n- **Unique**: `uq_unit_name` on `\\(name\\)` \\(via index\\)\n\n#### Indexes\n\n- `uq_unit_name` - UNIQUE index on `\\(name\\)`\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**:\n  - property \\(unit_id\\)\n  - recipe_part \\(unit_id\\)\n  - workflow_step \\(goo_amount_unit_id\\)\n\n---\n\n### smurf\n\n**Purpose**: Analytical methods and assay types \\(HPLC, GC, LC-MS, etc.\\)\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~50-100\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Assay/method name \\(UNIQUE\\) |\n| abbreviation | VARCHAR\\(20\\) | NULL | - | Short code |\n| disabled | INTEGER | NOT NULL | 0 | Soft delete flag |\n| description | VARCHAR\\(500\\) | NULL | - | Method description |\n| external_id | INTEGER | NULL | - | Legacy system ID |\n\n#### Constraints\n\n- **Primary Key**: `pk_smurf` on `\\(id\\)`\n- **Unique**: `uq_smurf_name` on `\\(name\\)`\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**:\n  - smurf_goo_type \\(smurf_id\\) - CASCADE DELETE\n  - smurf_property \\(smurf_id\\) - CASCADE DELETE\n  - smurf_group_member \\(smurf_id\\) - CASCADE DELETE\n  - workflow_step \\(smurf_id\\)\n  - fatsmurf \\(smurf_id\\)\n  - submission_entry \\(assay_type_id references smurf.id\\)\n\n---\n\n### container_type\n\n**Purpose**: Container hierarchy types \\(building, room, freezer, shelf, box, plate, well\\)\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: ~20-50\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Container type name \\(UNIQUE\\) |\n| abbreviation | VARCHAR\\(20\\) | NULL | - | Short code |\n| left_id | INTEGER | NOT NULL | - | Nested set left boundary |\n| right_id | INTEGER | NOT NULL | - | Nested set right boundary |\n| scope_id | VARCHAR\\(50\\) | NOT NULL | - | Nested set scope identifier |\n| depth | INTEGER | NOT NULL | 0 | Hierarchy depth |\n\n#### Constraints\n\n- **Primary Key**: `pk_container_type` on `\\(id\\)`\n- **Unique**: `uq_container_type_name` on `\\(name\\)`\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**:\n  - container \\(container_type_id\\)\n  - container_type_position \\(parent_container_type_id, child_container_type_id\\)\n  - robot_log_type \\(destination_container_type_id\\)\n\n#### Special Notes\n\n1. **Nested Set Model**: Similar to goo_type, enables efficient hierarchy queries\n2. **Position Rules**: container_type_position defines valid parent-child combinations\n\n---\n\n### m_number\n\n**Purpose**: Sequence generator for M-numbers \\(material identifiers\\)\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: 1 row\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY START 900000 | Sequence value |\n\n#### Constraints\n\n- **Primary Key**: `pk_m_number` on `\\(id\\)`\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**: None \\(sequence table\\)\n\n#### Special Notes\n\n1. **Identity Start**: Starts at 900000 \\(business requirement\\)\n2. **Usage**: Application inserts empty row and retrieves RETURNING id for new M-number\n3. **P0 Note**: Seed value fixed in migration \\(was initially incorrect\\)\n\n---\n\n### s_number\n\n**Purpose**: Sequence generator for S-numbers \\(sample identifiers\\)\n\n**Tier**: 0 \\(Base table\\)\n**Row Estimate**: 1 row\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY START 1 | Sequence value |\n\n#### Constraints\n\n- **Primary Key**: `pk_s_number` on `\\(id\\)`\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**: None\n- **Child Tables**: None \\(sequence table\\)\n\n#### Special Notes\n\n1. **Identity Start**: Starts at 1 \\(default\\)\n2. **Usage**: Application inserts empty row and retrieves RETURNING id for new S-number\n\n---\n\n## Tier 1 - First Level Dependencies\n\n**10 tables with foreign keys ONLY to Tier 0 tables.**\n\n---\n\n### ⭐ container \\(P0 CRITICAL\\)\n\n**Purpose**: Physical container hierarchy \\(nested set model\\) for inventory location tracking.\n\n**Tier**: 1\n**Row Estimate**: ~10,000-50,000\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| container_type_id | INTEGER | NOT NULL | - | Type reference \\(FK\\) |\n| name | VARCHAR\\(128\\) | NULL | - | Container name |\n| uid | VARCHAR\\(50\\) | NOT NULL | - | Unique identifier \\(UNIQUE\\) |\n| mass | DOUBLE PRECISION | NULL | - | Container mass \\(kg\\) |\n| left_id | INTEGER | NOT NULL | 1 | Nested set left boundary |\n| right_id | INTEGER | NOT NULL | 2 | Nested set right boundary |\n| scope_id | VARCHAR\\(50\\) | NOT NULL | gen_random_uuid\\(\\) | Nested set scope |\n| position_name | VARCHAR\\(50\\) | NULL | - | Position label \\(e.g., \"A1\"\\) |\n| position_x_coordinate | VARCHAR\\(50\\) | NULL | - | X coordinate in parent |\n| position_y_coordinate | VARCHAR\\(50\\) | NULL | - | Y coordinate in parent |\n| depth | INTEGER | NOT NULL | 0 | Hierarchy depth |\n| created_on | TIMESTAMP | NULL | CURRENT_TIMESTAMP | Creation timestamp |\n\n#### Constraints\n\n- **Primary Key**: `pk_container` on `\\(id\\)`\n- **Foreign Keys**:\n  - `container_fk_1`: container_type_id → container_type\\(id\\) ON DELETE NO ACTION\n\n#### Indexes\n\n- `idx_container_scope_left_right_depth` - Composite index for nested set queries\n- `idx_container_type_covering` - Covering index on container_type_id INCLUDE \\(id, mass\\) WITH \\(FILLFACTOR=70\\)\n- `uq_container_uid` - UNIQUE index on uid WITH \\(FILLFACTOR=90\\)\n\n#### Relationships\n\n- **Parent Tables**: \n  - container_type \\(container_type_id\\)\n- **Child Tables**:\n  - container_history \\(container_id\\) - CASCADE DELETE\n  - robot_run \\(robot_id\\)\n  - robot_log_container_sequence \\(container_id\\) - CASCADE DELETE\n  - fatsmurf \\(container_id\\) - SET NULL\n  - goo \\(container_id\\) - SET NULL\n  - material_inventory \\(allocation_container_id, location_container_id\\)\n\n#### Special Notes\n\n1. **P0 Critical**: All materials and experiments have location via container\n2. **Nested Set Model**: Efficient \"all items in freezer X\" queries\n3. **UID Foreign Key Target**: Used by FKs \\(unlike most tables that use id\\)\n4. **SET NULL Cascade**: Deleting container sets fatsmurf/goo container_id to NULL \\(not cascade delete\\)\n\n---\n\n### ⭐ perseus_user\n\n**Purpose**: Application users with role-based access control.\n\n**Tier**: 1\n**Row Estimate**: ~50-200\n\n#### Columns\n\n| Column | Type | Nullable | Default | Description |\n|--------|------|----------|---------|-------------|\n| id | INTEGER | NOT NULL | IDENTITY | Primary key |\n| name | VARCHAR\\(128\\) | NOT NULL | - | Full name |\n| domain_id | VARCHAR\\(250\\) | NULL | - | Active Directory ID |\n| login | VARCHAR\\(50\\) | NULL | - | Username |\n| mail | VARCHAR\\(50\\) | NULL | - | Email address |\n| admin | INTEGER | NOT NULL | 0 | Admin flag \\(0=no, 1=yes\\) |\n| super | INTEGER | NOT NULL | 0 | Superuser flag |\n| common_id | INTEGER | NULL | - | Shared account ID |\n| manufacturer_id | INTEGER | NOT NULL | 1 | Associated organization \\(FK\\) |\n\n#### Constraints\n\n- **Primary Key**: `pk_perseus_user` on `\\(id\\)`\n- **Foreign Keys**:\n  - `fk_perseus_user_manufacturer`: manufacturer_id → manufacturer\\(id\\) ON DELETE NO ACTION\n  - **Note**: Originally had 3 duplicate FKs - consolidated to 1\n\n#### Indexes\n\nNone\n\n#### Relationships\n\n- **Parent Tables**:\n  - manufacturer \\(manufacturer_id\\)\n- **Child Tables** \\(22+ tables reference this\\):\n  - history \\(creator_id\\)\n  - workflow \\(added_by\\)\n  - feed_type \\(added_by, updated_by_id\\)\n  - field_map_display_type_user \\(user_id\\) - CASCADE DELETE\n  - material_inventory_threshold \\(created_by_id, updated_by_id\\)\n  - saved_search \\(added_by\\)\n  - smurf_group \\(added_by\\)\n  - workflow_attachment \\(added_by\\)\n  - recipe \\(added_by\\)\n  - fatsmurf \\(added_by\\)\n  - fatsmurf_attachment \\(added_by\\)\n  - fatsmurf_comment \\(added_by\\)\n  - fatsmurf_reading \\(added_by\\)\n  - goo \\(added_by\\)\n  - goo_attachment \\(added_by\\)\n  - goo_comment \\(added_by\\)\n  - material_inventory \\(created_by_id, updated_by_id\\)\n  - material_inventory_threshold_notify_user \\(user_id\\)\n  - submission \\(submitter_id\\)\n  - submission_entry \\(prepped_by_id\\)\n\n#### Special Notes\n\n1. **P0 Critical**: Referenced by 22+ tables - must exist before most other tables\n2. **Duplicate FK Issue**: Migration fixed 3 duplicate FKs to manufacturer → 1 FK\n3. **Role Flags**: admin and super columns control permissions\n\n---\n\nEOF)"
    ]
  },
  "enableAllProjectMcpServers": true,
  "enabledMcpjsonServers": [
    "claude-context",
    "context7",
    "sequentialthinking"
  ]
}
